<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æµ·é“äº”æ—¥éŠè¡Œç¨‹ | 2026 (å³æ™‚åŒæ­¥ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-purple': '#7C3AED', 
                        'secondary-pink': '#EC4899', 
                        'bg-light': '#F9FAFB', 
                        'card-bg': '#FFFFFF',
                    }
                }
            }
        }
    </script>
    <style>
        .app-container {
            height: calc(100vh - 64px); 
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .horizontal-scroll-menu::-webkit-scrollbar {
            display: none;
        }
        .horizontal-scroll-menu {
            -ms-overflow-style: none; 
            scrollbar-width: none;
        }
        .schedule-item {
            border-left: 2px solid #E5E7EB; 
        }
        .app-input {
            @apply block w-full border-gray-200 rounded-lg shadow-sm p-3 focus:ring-primary-purple focus:border-primary-purple bg-bg-light transition duration-150;
        }
        .nav-button {
            @apply flex-1 p-2 rounded-xl font-semibold transition duration-300 mx-1 text-sm;
        }
        .nav-active {
            @apply bg-primary-purple text-white shadow-lg;
        }
        .nav-inactive {
            @apply text-gray-600 hover:bg-gray-100;
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen">

<div id="app" class="max-w-md mx-auto shadow-2xl bg-white border-x border-gray-100">

    <header class="bg-primary-purple text-white p-4 sticky top-0 z-20 shadow-lg">
        <h1 class="text-xl font-extrabold text-center tracking-wide">
            <i class="fas fa-snowflake mr-2"></i>åŒ—æµ·é“ä¹‹æ—… 2026
        </h1>
        <p class="text-xs text-center mt-1 opacity-80">å‡½é¤¨/æœ­å¹Œ â€¢ äº”æ—¥éŠ (å³æ™‚åŒæ­¥)</p>
    </header>

    <nav class="flex justify-around bg-card-bg p-2 sticky top-16 z-10 shadow-md">
        <button @click="currentTab = 'splitting'" :class="{'nav-active': currentTab === 'splitting', 'nav-inactive': currentTab !== 'splitting'}" class="nav-button">ğŸ’° åˆ†å¸³è¨ˆç®—</button>
        <button @click="currentTab = 'schedule'" :class="{'nav-active': currentTab === 'schedule', 'nav-inactive': currentTab !== 'schedule'}" class="nav-button">ğŸ“… è¡Œç¨‹è¡¨</button>
        <button @click="currentTab = 'map'" :class="{'nav-active': currentTab === 'map', 'nav-inactive': currentTab !== 'map'}" class="nav-button">ğŸ—ºï¸ åœ°åœ–</button>
    </nav>

    <div class="app-container">

        <section v-if="currentTab === 'splitting'" class="p-4 space-y-6">
            <h2 class="text-2xl font-bold text-gray-800 border-b pb-2 mb-4">ğŸ’° æ—…è²»åˆ†å¸³èˆ‡çµç®—</h2>
            
            <div class="bg-card-bg p-5 rounded-xl shadow-lg border-l-4 border-secondary-pink">
                <h3 class="text-lg font-bold mb-3 text-secondary-pink flex items-center"><i class="fas fa-exchange-alt mr-2"></i> é›™å‘åŒ¯ç‡æ›ç®— (1 JPY = {{ exchangeRate.jpyTwd }} TWD)</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ—¥å¹£ (JPY) è½‰ å°å¹£ (TWD)</label>
                        <input type="number" v-model.number="currencyInput.jpy" placeholder="è¼¸å…¥æ—¥å¹£é‡‘é¡ (JPY)" class="app-input">
                        <p class="mt-2 text-sm text-gray-600">ç´„ï¼š<span class="font-bold text-primary-purple text-lg">{{ (currencyInput.jpy * exchangeRate.jpyTwd).toFixed(2) }} TWD</span></p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å°å¹£ (TWD) è½‰ æ—¥å¹£ (JPY)</label>
                        <input type="number" v-model.number="currencyInput.twd" placeholder="è¼¸å…¥å°å¹£é‡‘é¡ (TWD)" class="app-input">
                        <p class="mt-2 text-sm text-gray-600">ç´„ï¼š<span class="font-bold text-primary-purple text-lg">{{ (currencyInput.twd / exchangeRate.jpyTwd).toFixed(2) }} JPY</span></p>
                    </div>
                </div>
            </div>

            <div class="bg-card-bg p-5 rounded-xl shadow-lg border-l-4 border-primary-purple">
                <h3 class="text-lg font-bold mb-3 text-primary-purple flex items-center"><i class="fas fa-plus-circle mr-2"></i> ç´€éŒ„æ–°æ”¯å‡º</h3>
                <div class="space-y-3">
                    <input type="text" v-model="newExpense.description" placeholder="ç”¨é€” (e.g. æ™šé¤)" class="app-input">
                    <div class="flex space-x-2">
                        <input type="number" v-model.number="newExpense.amount" placeholder="é‡‘é¡" class="app-input w-2/3">
                        <select v-model="newExpense.currency" class="app-input w-1/3">
                            <option value="TWD">TWD</option>
                            <option value="JPY">JPY</option>
                        </select>
                    </div>
                    
                    <select v-model="newExpense.paidBy" class="app-input">
                        <option disabled value="">-- èª°ä»˜çš„éŒ¢ï¼Ÿ --</option>
                        <option v-for="p in participants" :key="p" :value="p">{{ p }}</option>
                    </select>
                    
                    <p class="text-sm font-medium text-gray-700">åƒèˆ‡è€… (éœ€åˆ†å¸³è€…)ï¼š</p>
                    <div class="flex space-x-3">
                        <div v-for="p in participants" :key="p" class="flex items-center">
                            <input type="checkbox" :id="'split-' + p" :value="p" v-model="newExpense.splitWith" class="rounded text-primary-purple focus:ring-primary-purple">
                            <label :for="'split-' + p" class="ml-2 text-sm">{{ p }}</label>
                        </div>
                    </div>
                    
                    <button @click="addExpense" class="w-full bg-secondary-pink text-white p-3 rounded-lg font-bold hover:bg-secondary-pink/90 transition duration-200 mt-2">
                        ç´€éŒ„æ”¯å‡º
                    </button>
                </div>
            </div>
            
            <div class="mt-6">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fas fa-list-alt mr-2"></i> æ”¯å‡ºæ˜ç´° (ç¸½ TWD: {{ totalExpensesTWD.toFixed(2) }})</h3>
                <ul class="space-y-2">
                    <li v-for="(exp, index) in expenses" :key="index" class="bg-card-bg p-3 rounded-lg shadow-sm text-sm border-l-4 border-gray-100">
                        <div class="flex justify-between items-start">
                            <p class="font-semibold text-gray-800">{{ exp.description }}</p>
                            <p class="text-lg font-extrabold text-primary-purple">{{ exp.amount }} {{ exp.currency }}</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">
                            ä»˜æ¬¾äºº: <span class="font-medium">{{ exp.paidBy }}</span> | åƒèˆ‡è€…: {{ exp.splitWith.join(', ') }}
                            <span v-if="exp.currency !== 'TWD'" class="text-secondary-pink ml-2">({{ (exp.amount * exchangeRate.jpyTwd).toFixed(2) }} TWD)</span>
                        </p>
                    </li>
                </ul>
            </div>

            <div class="mt-6 border-t pt-4 border-gray-100">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fas fa-balance-scale-right mr-2"></i> çµç®—çµæœ (TWD)</h3>
                <ul class="text-sm space-y-2">
                    <li v-for="(result, p) in settlementResults" :key="p" 
                        :class="{'border-green-400 bg-green-50': result > 0, 'border-red-400 bg-red-50': result < 0}"
                        class="p-3 rounded-lg flex justify-between items-center border">
                        <span class="font-bold">{{ p }}</span> 
                        <span v-if="result > 0" class="font-extrabold text-green-600">æ‡‰æ”¶ {{ result.toFixed(2) }} TWD</span>
                        <span v-else-if="result < 0" class="font-extrabold text-red-600">æ‡‰ä»˜ {{ Math.abs(result).toFixed(2) }} TWD</span>
                        <span v-else class="text-gray-500">å·²çµæ¸…</span>
                    </li>
                </ul>
            </div>
        </section>

        <section v-else-if="currentTab === 'schedule'" class="pt-4">
            
            <div class="horizontal-scroll-menu flex overflow-x-scroll p-2 space-x-3 mb-4 sticky top-[68px] bg-bg-light/95 backdrop-blur-sm z-10">
                <button v-for="day in scheduleData" :key="day.date" 
                        @click="selectedDay = day.date"
                        :class="{'bg-primary-purple text-white shadow-md': selectedDay === day.date, 'bg-card-bg text-gray-700 border border-gray-200': selectedDay !== day.date}"
                        class="flex-shrink-0 p-3 rounded-xl transition duration-300 text-sm font-medium">
                    <div class="text-xs font-light">{{ day.date.substring(5) }}</div>
                    <div class="font-bold">{{ day.dayName.split(' ')[0] }}</div>
                </button>
            </div>

            <div v-for="day in scheduleData" :key="day.date" v-show="selectedDay === day.date" class="p-4 space-y-6">
                
                <h2 class="text-2xl font-bold text-gray-800 mb-2">{{ day.dayName }}</h2>
                
                <div class="flex items-center justify-between bg-card-bg p-4 rounded-xl shadow-inner border border-secondary-pink/30 text-secondary-pink">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-cloud-sun text-2xl"></i>
                        <div>
                            <p class="font-bold text-lg">{{ day.weather.temp }}Â°C</p>
                            <p class="text-xs">æ°£æº«é æ¸¬ ({{ day.weather.condition }})</p>
                        </div>
                    </div>
                    <button class="text-xs text-gray-500 hover:text-primary-purple/70">
                        <i class="fas fa-map-marker-alt mr-1"></i> {{ day.location }}
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div v-for="(item, index) in day.events" :key="index" class="schedule-item relative pl-6 py-2 transition duration-150">
                        <div class="absolute left-[-5px] top-4 w-3 h-3 bg-white border-2 border-primary-purple rounded-full shadow"></div>
                        
                        <p class="text-xs font-light text-primary-purple mb-1">{{ item.time }}</p>
                        <div class="flex justify-between items-center">
                            <p class="text-base font-semibold text-gray-800">{{ item.place }}</p>
                            <a :href="getGoogleMapsLink(item.place)" target="_blank" class="text-sm text-secondary-pink hover:text-secondary-pink/70 transition duration-150 flex items-center">
                                <i class="fas fa-route mr-1"></i> å°èˆª
                            </a>
                        </div>
                        <p v-if="item.note" class="text-sm text-gray-500 mt-1">{{ item.note }}</p>
                    </div>
                </div>
                <button class="mt-4 w-full text-center text-sm text-secondary-pink border border-secondary-pink/50 p-3 rounded-xl hover:bg-secondary-pink/10 transition duration-200 font-medium">
                    <i class="fas fa-plus mr-1"></i> æ–°å¢è¡Œç¨‹
                </button>
            </div>
        </section>
        
        <section v-else-if="currentTab === 'map'" class="p-4 space-y-6">
            <h2 class="text-2xl font-bold text-gray-800 border-b pb-2 mb-4">ğŸ—ºï¸ æ™¯é»åœ°åœ–èˆ‡å®šä½</h2>
            
            <div class="bg-card-bg p-4 rounded-xl shadow-lg border border-primary-purple/30">
                <h3 class="font-bold text-lg text-primary-purple mb-3 flex items-center"><i class="fas fa-location-arrow mr-2"></i> æˆ‘çš„ç•¶å‰ä½ç½® (æ¨¡æ“¬)</h3>
                <div class="flex justify-between items-center bg-bg-light p-3 rounded-lg text-gray-700">
                    <span class="font-medium">ç·¯åº¦/ç¶“åº¦: 41.7687, 140.7287</span>
                    <i class="fas fa-dot-circle text-secondary-pink"></i>
                </div>
            </div>

            <div class="bg-card-bg p-4 rounded-xl shadow-lg h-80 flex flex-col items-center justify-center text-gray-500 border border-primary-purple/30">
                <i class="fas fa-map-marked-alt text-4xl mb-3 text-primary-purple/70"></i>
                <p class="text-center font-medium">åœ°åœ–é¡¯ç¤ºå€</p>
                <p class="text-xs mt-1">ç•¶æ—¥ {{ getEventsByDate(selectedDay).length }} å€‹æ™¯é»å·²é‡˜é¸</p>
            </div>

            <div class="mt-4">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fas fa-map-pin mr-2"></i> ç•¶æ—¥æ™¯é»æ¸…å–® ({{ selectedDay.substring(5) }})</h3>
                <ul class="space-y-2">
                    <li v-for="(item, index) in getEventsByDate(selectedDay)" :key="index" class="bg-card-bg p-3 rounded-lg shadow-sm text-sm border-l-4 border-secondary-pink">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">{{ item.place }}</p>
                            <a :href="getGoogleMapsLink(item.place)" target="_blank" class="text-primary-purple hover:underline text-xs flex items-center">
                                <i class="fas fa-search mr-1"></i> æŸ¥è©¢åœ°åœ–
                            </a>
                        </div>
                        <p class="text-xs text-gray-500">{{ item.time }}</p>
                    </li>
                </ul>
            </div>
        </section>

    </div>
</div>

<script type="module">
    // å¼•å…¥ Firebase SDK å’Œ Vue 3
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
    import { getFirestore, doc, onSnapshot, updateDoc } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js';
    
    const { ref, reactive, computed, onMounted } = Vue;

    // ğŸŒŸğŸŒŸğŸŒŸ ã€å·²å¡«å…¥æ‚¨çš„ Firebase é‡‘é‘°ã€‘ ğŸŒŸğŸŒŸğŸŒŸ
    const firebaseConfig = {
        apiKey: "AIzaSyDym3kPm4sCqjoGfL5LRZCzVyx1toJIHD8", 
        authDomain: "hokkaido-trip-2026-84f2f.firebaseapp.com", 
        projectId: "hokkaido-trip-2026-84f2f", 
        storageBucket: "hokkaido-trip-2026-84f2f.firebasestorage.app",
        messagingSenderId: "284815822316",
        appId: "1:284815822316:web:053bb0395a9065635f44c9"
        // measurementId å¯çœç•¥ï¼Œä¸å½±éŸ¿æ ¸å¿ƒåŠŸèƒ½
    };

    // åˆå§‹åŒ– Firebase å’Œ Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    // è¨­å®šè³‡æ–™è·¯å¾‘ï¼šCollection ç‚º tripsï¼ŒDocument ID ç‚º hokkaido-2026
    const tripDocRef = doc(db, "trips", "hokkaido-2026");

    // Vue æ‡‰ç”¨ç¨‹å¼é‚è¼¯
    const App = {
        setup() {
            // æ ¸å¿ƒç‹€æ…‹ï¼Œå°‡å¾ Firebase åŒæ­¥
            const scheduleData = reactive([]); 
            const expenses = reactive([]);     
            
            // UI/å·¥å…·ç‹€æ…‹ (æœ¬åœ°ç‹€æ…‹)
            const currentTab = ref('splitting');
            const selectedDay = ref('2026-01-02'); 
            const exchangeRate = reactive({ jpyTwd: 0.22 });
            const currencyInput = reactive({ jpy: 10000, twd: 5000 });
            const participants = ref(['A', 'B']); 
            
            const newExpense = reactive({
                description: '',
                amount: 0,
                currency: 'JPY',
                paidBy: '',
                splitWith: [...participants.value]
            });

            // åˆå§‹æ•¸æ“šçµæ§‹ (è‹¥è³‡æ–™åº«ä¸­å°šç„¡è³‡æ–™ï¼Œå‰‡æœƒå¯«å…¥æ­¤çµæ§‹)
            const initialScheduleData = [
                {
                    dayName: 'Day 1 å°ç£â†’å‡½é¤¨',
                    date: '2026-01-02',
                    location: 'å‡½é¤¨',
                    weather: { temp: '-2', condition: 'å¤šé›²æ™‚æ™´' }, 
                    events: [
                        { time: '06:45', place: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ (TPE)', note: 'æ©Ÿç¥¨ï¼šè™èˆª6:45-11:10å‡½é¤¨' },
                        { time: '11:10', place: 'å‡½é¤¨æ©Ÿå ´ (HKD)', note: 'æŠµé”å‡½é¤¨' },
                        { time: '14:30', place: 'é‡‘æ£®ç´…ç£šå€‰åº«', note: '' },
                        { time: '17:00', place: 'å‡½é¤¨å±±å¤œæ™¯', note: 'æ­ä¹˜çºœè»Š' },
                        { time: '20:00', place: 'å‡½é¤¨æ™šé¤', note: 'å¤–å¸¶/å±…é…’å±‹' },
                        { time: '21:00', place: 'æ¹¯ä¹‹å·æº«æ³‰', note: 'æº«æ³‰æˆ–ä¼‘æ¯' },
                    ]
                },
                {
                    dayName: 'Day 2 å‡½é¤¨',
                    date: '2026-01-03',
                    location: 'å‡½é¤¨/æœ­å¹Œç§»å‹•ä¸­',
                    weather: { temp: '0', condition: 'ä¸‹é›ª' }, 
                    events: [
                        { time: '10:00', place: 'å‡½é¤¨æœå¸‚', note: '' },
                        { time: '13:30', place: 'äº”ç¨œéƒ­å…¬åœ’', note: '' },
                        { time: '16:00', place: 'å‡½é¤¨ç«™', note: 'å‰å¾€æœ­å¹Œ' },
                        { time: '20:00', place: 'æœ­å¹Œé£¯åº— Check In', note: '' },
                    ]
                },
                {
                    dayName: 'Day 3 æœ­å¹Œ',
                    date: '2026-01-04',
                    location: 'æœ­å¹Œ',
                    weather: { temp: '-5', condition: 'å¤§é›ª' }, 
                    events: [
                        { time: '10:00', place: 'åŒ—æµ·é“ç¥å®®', note: '' },
                        { time: '13:00', place: 'åœ“å±±å‹•ç‰©åœ’', note: '' },
                        { time: '15:30', place: 'ç™½è‰²æˆ€äººå…¬åœ’', note: '' },
                        { time: '18:00', place: 'ç‹¸å°è·¯å•†åº—è¡—', note: 'æ™šé¤' },
                    ]
                },
                {
                    dayName: 'Day 4 æ»‘é›ªæ—¥',
                    date: '2026-01-05',
                    location: 'æ»‘é›ªå ´ (å¦‚å°æ¨½å¤©ç‹—å±±)',
                    weather: { temp: '-8', condition: 'é£„é›ª' }, 
                    events: [
                        { time: '09:00', place: 'æœ­å¹Œâ†’æ»‘é›ªå ´', note: 'å…¨æ—¥æ»‘é›ªæ´»å‹•' },
                        { time: '18:00', place: 'æ»‘é›ªå ´â†’æœ­å¹Œå¸‚å€', note: 'æ™šé¤' },
                    ]
                },
                {
                    dayName: 'Day 5 æœ­å¹Œâ†’å°ç£',
                    date: '2026-01-06',
                    location: 'æ–°åƒæ­²æ©Ÿå ´',
                    weather: { temp: '-1', condition: 'å°é›ª' }, 
                    events: [
                        { time: '11:00', place: 'åŒ—æµ·é“å¤§å­¸', note: '' },
                        { time: '12:30', place: 'æœ­å¹Œå ´å¤–å¸‚å ´', note: 'åˆé¤' },
                        { time: '14:30', place: 'æ–°åƒæ­²æ©Ÿå ´ (CTS)', note: 'é€›è¡—è³¼ç‰©' },
                        { time: '18:40', place: 'é£›æ©Ÿå›å°', note: 'é…·èˆª 18:40-22:15å°ç£' },
                    ]
                },
            ];

            const initialExpenses = [
                { description: 'æ©Ÿç¥¨ (è™èˆª+é…·èˆª)', paidBy: 'A', amount: 15000, currency: 'TWD', splitWith: ['A', 'B'] },
                { description: 'Day 1 æ™šé¤', paidBy: 'B', amount: 8000, currency: 'JPY', splitWith: ['A', 'B'] },
                { description: 'Day 2 å‡½é¤¨æœå¸‚', paidBy: 'A', amount: 5000, currency: 'JPY', splitWith: ['A', 'B'] },
            ];

            // ã€æ ¸å¿ƒåŠŸèƒ½ï¼šå¯«å…¥è³‡æ–™åº«ã€‘
            const updateFirebaseData = (newData) => {
                updateDoc(tripDocRef, newData)
                    .then(() => console.log("è³‡æ–™æˆåŠŸå¯«å…¥ Firebase!"))
                    .catch(error => console.error("å¯«å…¥éŒ¯èª¤:", error));
            };

            // ã€æ ¸å¿ƒåŠŸèƒ½ï¼šå³æ™‚åŒæ­¥è®€å–ã€‘
            onMounted(() => {
                onSnapshot(tripDocRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        
                        scheduleData.splice(0, scheduleData.length, ...data.scheduleData);
                        expenses.splice(0, expenses.length, ...data.expenses);
                        
                        if (!data.scheduleData.find(d => d.date === selectedDay.value)) {
                            selectedDay.value = data.scheduleData[0]?.date || '2026-01-02';
                        }
                        
                        console.log("Firebase è³‡æ–™å·²æ›´æ–°ï¼");
                    } else {
                        console.log("è³‡æ–™åº«ç„¡ç´€éŒ„ï¼Œå¯«å…¥åˆå§‹æ•¸æ“šã€‚");
                        // é¦–æ¬¡è¼‰å…¥æ™‚ï¼Œå°‡åˆå§‹æ•¸æ“šå¯«å…¥ Firebase
                        updateFirebaseData({ 
                            scheduleData: initialScheduleData, 
                            expenses: initialExpenses 
                        });
                    }
                });
            });

            // ã€åˆ†å¸³æ“ä½œï¼šæ”¹ç‚ºæ›´æ–° Firebaseã€‘
            const addExpense = () => {
                if (newExpense.description && newExpense.amount > 0 && newExpense.paidBy && newExpense.splitWith.length > 0) {
                    const updatedExpenses = [...expenses, { ...newExpense }];
                    updateFirebaseData({ expenses: updatedExpenses }); // é€é Firebase å¯«å…¥
                    // é‡ç½®è¡¨å–®
                    newExpense.description = '';
                    newExpense.amount = 0;
                    newExpense.paidBy = '';
                    newExpense.splitWith = [...participants.value]; 
                } else {
                    alert('è«‹å¡«å¯«å®Œæ•´æ”¯å‡ºè³‡è¨Š');
                }
            };
            
            // ... (è¨ˆç®—å±¬æ€§å’Œæ–¹æ³•)
            const totalExpensesTWD = computed(() => { 
                return expenses.reduce((sum, exp) => {
                    let amountTWD = exp.amount;
                    if (exp.currency === 'JPY') {
                        amountTWD = exp.amount * exchangeRate.jpyTwd;
                    }
                    return sum + amountTWD;
                }, 0);
            });

            const settlementResults = computed(() => { 
                const balance = {};
                participants.value.forEach(p => balance[p] = 0); 

                expenses.forEach(exp => {
                    let amountTWD = exp.amount;
                    if (exp.currency === 'JPY') {
                        amountTWD = exp.amount * exchangeRate.jpyTwd;
                    }
                    const numSplit = exp.splitWith.length;
                    if (numSplit === 0) return; 
                    const share = amountTWD / numSplit; 

                    balance[exp.paidBy] += amountTWD;

                    exp.splitWith.forEach(person => {
                        balance[person] -= share;
                    });
                });
                return balance;
            });

            const getEventsByDate = (date) => { 
                const day = scheduleData.find(d => d.date === date);
                return day ? day.events : [];
            };

            const getGoogleMapsLink = (placeName) => { 
                const encodedPlace = encodeURIComponent(placeName + ', æ—¥æœ¬ åŒ—æµ·é“');
                return `https://www.google.com/maps/search/?api=1&query=${encodedPlace}`;
            };


            return {
                currentTab, selectedDay, scheduleData, expenses, 
                exchangeRate, currencyInput, participants, newExpense, 
                addExpense, totalExpensesTWD, settlementResults, 
                getEventsByDate, getGoogleMapsLink,
            };
        }
    };

    // æ›è¼‰ Vue æ‡‰ç”¨ç¨‹å¼
    Vue.createApp(App).mount('#app');
</script>

</body>
</html>3